#!/usr/bin/env node

var program = require("commander"),
    fetcher = require("../"),
    canonicalJSON = require('canonical-json');

program
  .version("0.0.1")
  .option("-i, --isbn <isbn>",     "  Book's ISBN")
  .option("-c, --country <country>", "Country code")
  .option("-u, --currency <vendor>", "Currency code")
  .option("-v, --vendor <vendor>",   "Vendor code");

program.parse(process.argv);

// check that we have all required args
if (!program.isbn || !program.vendor || !program.country || !program.currency) {
  console.error('Usage: l2b-price-fetch --isbn .... --vendor .... --country GB --currency GBP');
  process.exit(1);
}


console.log(
  "Fetching price etc for '%s' from '%s'",
  program.isbn,
  program.vendor
);

fetcher.fetch(
  {
    isbn:     program.isbn,
    vendor:   program.vendor,
    country:  program.country,
    currency: program.currency,
  },
  function (err, data) {
    if (err) {throw err};
    console.log(canonicalJSON(data, null, 2));
  }
);
